'''   321Movies.co | Stream TVsupertuga   Copyright (C) 2017 Mister-X   This program is free software: you can redistribute it and/or modify   it under the terms of the GNU General Public License as published by   the Free Software Foundation, either version 3 of the License, or   (at your option) any later version.   This program is distributed in the hope that it will be useful,   but WITHOUT ANY WARRANTY; without even the implied warranty of   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the   GNU General Public License for more details.   You should have received a copy of the GNU General Public License   along with this program.  If not, see <http://www.gnu.org/licenses/>.'''import urllib,urllib2,re,xbmcplugin,xbmcgui,urlresolver,sys,xbmc,xbmcaddon,os,urlparse,base64from t0mm0.common.addon import Addonfrom metahandler import metahandlersfrom resources.lib import utilsaddon_id = utils.addon_idaddDir = utils.addDiraddLink = utils.addLinkselfAddon = utils.selfAddonaddon = utils.addonfanart = utils.fanarticon = utils.addonnext = utils.nextart = utils.artname = utils.namemode = utils.modeurl = utils.urliconimage = utils.iconimagesite = utils.sitesetView = utils.setViewopen_url = utils.open_urlBASEURL = selfAddon.getSetting('BASEURL')def MAIN():		addDir('Search',BASEURL+'/index.php',3,art+'search.png',fanart)		addDir('Movies','http://ignorme',7,art+'movies.png',fanart)		addDir('TV Shows','http://ignorme',8,art+'tvshows.png',fanart)		xbmc.executebuiltin('Container.SetViewMode(50)')def TVSHOWINDEX():		addDir('All TV Shows',BASEURL+'/anime',2,art+'alltvshows.png',fanart)		addDir('Recently Added Seasons',BASEURL+'/seasons',9,art+'recently.png',fanart)		addDir('Recently Added Episode',BASEURL+'/episodes',200,art+'recently.png',fanart)		addDir('Best Ratings',BASEURL+'/ratings?get=anime',2,art+'best.png',fanart)		xbmc.executebuiltin('Container.SetViewMode(50)')				def MOVIESINDEX():		addDir('HD Movies',BASEURL+'/quality/hd',16,art+'hdmovies.png',fanart)		addDir('Movies',BASEURL+'/film',19,art+'movies.png',fanart)		addDir('Trending Movies',BASEURL+'/trending',11,art+'trending.png',fanart)		addDir('Genres',BASEURL,5,art+'genres.png',fanart)		addDir('Realease Year',BASEURL,6,art+'release.png',fanart)		addDir('Best Ratings',BASEURL+'/ratings?get=movies',19,art+'best.png',fanart)		xbmc.executebuiltin('Container.SetViewMode(50)')def GETMOVIES(url):	link = open_url(url)	match=re.compile('<a href="([^"]+)"><img src="([^"]+)" alt="Watch ([^"]+) For Free"></a>[^"]+<div class="rating"><span class="icon-star2"></span> ([^"]+)</div>[^"]+<span class="quality">([^"]+)</span>',re.DOTALL).findall(link)	for url, img, name, rating, quality in match:			try:				name = name.replace('&#8217;','\'').replace('#038;','').replace('\\xc3\\xa9','e').replace('&#8211;','-')				name = name + ":" + " " + "Quality:" + " " + "[COLOR dodgerblue]" + " " + quality + "[/COLOR]" + " " + "|" + " " + " " + "Rating:" "[COLOR dodgerblue]" + " " + rating + "[/COLOR]"				addDir(name,url,12,img,fanart)			except:pass	try:		np=re.compile("<link rel='next' href='(.+?)'", re.DOTALL | re.IGNORECASE).findall(link)[0]		name = '[COLOR dodgerblue]' + 'Next Page >>' + '[/COLOR]'		addDir(name,np,19,next,fanart)	except:pass	xbmc.executebuiltin('Container.SetViewMode(50)')def GETHD(url):	link = open_url(url)	match=re.compile('<a href="([^"]+)".*?src="([^"]+)" alt="Watch ([^"]+) For Free".*?',re.DOTALL).findall(link)	for url, img, name in match:			try:				name = name.replace('&#8217;','\'').replace('#038;','').replace('\\xc3\\xa9','e').replace('&#8211;','-').replace('&#039;','`')				name = name + ":" + " " + "Quality:" + " " + "[COLOR dodgerblue]" + " " + "HD" + "[/COLOR]"				addDir(name,url,12,img,fanart)			except:pass	try:		np=re.compile("<link rel='next' href='(.+?)'", re.DOTALL | re.IGNORECASE).findall(link)[0]		name = '[COLOR dodgerblue]' + 'Next Page >>' + '[/COLOR]'		addDir(name,np,16,next,fanart)	except:pass	xbmc.executebuiltin('Container.SetViewMode(50)')def GETTRENDING(url, name):        link = open_url(url)        match=re.compile('<a href="([^"]+)"><img src="([^"]+)" alt="Watch ([^"]+) For Free"></a>[^"]+<div class="rating"><span class="icon-star2"></span> ([^"]+)</div>[^"]+<span class="quality">([^"]+)</span>',re.DOTALL).findall(link)        for url, img, name, rating, quality in match:			try:				name = name.replace('&#8217;','\'').replace('#038;','').replace('\\xc3\\xa9','e').replace('&#8211;','-').replace('&#039;','`')				name = name + ":" + " " + "Quality:" + " " + "[COLOR dodgerblue]" + " " + quality + "[/COLOR]" + " " + "|" + " " + " " + "Rating:" "[COLOR dodgerblue]" + " " + rating + "[/COLOR]"				addDir(name,url,12,img,fanart)			except:pass	try:		np=re.compile('<a href="http://321movies.co/trending/page/([^"]+)"', re.DOTALL | re.IGNORECASE).findall(link)[0]		np = BASEURL + '/trending/page/' + np		name = '[COLOR dodgerblue]' + 'Next Page >>' + '[/COLOR]'		addDir(name,np,11,next,fanart)	except:pass	xbmc.executebuiltin('Container.SetViewMode(50)')	def GETTV(url,name):        link = open_url(url)        match=re.compile('<div class="poster">[^"]+<a href="([^"]+)"><img src="([^"]+)" alt="([^"]+)"></a>[^"]+<div class="rating"><span class="icon-star2"></span> ([^"]+)</div>[^"]+</div>',re.DOTALL).findall(link)        for url, img, name, rating in match:			name = name.replace('&#8217;','\'').replace('#038;','').replace('\\xc3\\xa9','e').replace('&#8211;','-').replace('&#039;','`')			name = name + ":" + " " + "Rating:" + " " + "[COLOR dodgerblue]" + " " + rating + "[/COLOR]"			addDir(name,url,4,img,fanart='')	try:		np=re.compile("<link rel='next' href='(.+?)'", re.DOTALL | re.IGNORECASE).findall(link)[0]		name = '[COLOR dodgerblue]' + 'Next Page >>' + '[/COLOR]'		addDir(name,np,2,next,fanart)	except:pass	xbmc.executebuiltin('Container.SetViewMode(50)')def GETTV1(url,name):        link = open_url(url)        match=re.compile('<img src="([^"]+)" alt="([^"]+)">[^"]+<div class="season_m animation-1">[^"]+<a href="([^"]+)"',re.DOTALL).findall(link)        for img, name, url in match:			name = name.replace('&#8217;','\'').replace('#038;','').replace('\\xc3\\xa9','e').replace('&#8211;','-').replace('&#039;','`')			addDir(name,url,10,img,fanart='')	try:		np=re.compile("<link rel='next' href='(.+?)'", re.DOTALL | re.IGNORECASE).findall(link)[0]		name = '[COLOR dodgerblue]' + 'Next Page >>' + '[/COLOR]'		addDir(name,np,9,next,fanart)	except:pass	xbmc.executebuiltin('Container.SetViewMode(50)')	def GETEPISODE(url,name):        link = open_url(url)        match=re.compile('<img src="([^"]+)"></a></div>[^"]+<div class="numerando">([^"]+) - ([^"]+)</div>[^"]+<div class="episodiotitle">[^"]+<a href="([^"]+)">([^"]+)</a>',re.DOTALL).findall(link)        for  img, season, episode, url, name in match:			name = name.replace('&#8217;','\'').replace('#038;','').replace('\\xc3\\xa9','e').replace('&#8211;','-').replace('&#039;','`')			name = "Season:" + " " + "[COLOR dodgerblue]" + " " + season + "[/COLOR]" + " " + "|" + " " + " " + "Episode:" "[COLOR dodgerblue]" + " " + episode + "[/COLOR]" + ":   " + name			addDir(name,url,12,img,fanart)	xbmc.executebuiltin('Container.SetViewMode(50)')def GETEPISODE1(url,name):        link = open_url(url)        match=re.compile('<img src="([^"]+)"></a></div>[^"]+<div class="numerando">([^"]+)x([^"]+)</div>[^"]+<div class="episodiotitle">[^"]+<a href="([^"]+)">([^"]+)</a>',re.DOTALL).findall(link)        for  img, season, episode, url, name in match:			name = name.replace('&#8217;','\'').replace('#038;','').replace('\\xc3\\xa9','e').replace('&#8211;','-').replace('&#039;','`')			name = "Season:" + " " + "[COLOR dodgerblue]" + " " + season + "[/COLOR]" + " " + "|" + " " + " " + "Episode:" "[COLOR dodgerblue]" + " " + episode + "[/COLOR]" + ":   " + name			addDir(name,url,12,img,fanart)	xbmc.executebuiltin('Container.SetViewMode(50)')def GETEPISODE2(url,name):        link = open_url(url)        match=re.compile('<img src="([^"]+)" alt="([^"]+) [^"]+">[^"]+<div class="season_m animation-1">[^"]+<a href="([^"]+)">[^"]+<span class="b">([^"]+)x([^"]+)</span>',re.DOTALL).findall(link)        for img, name, url, season, episode in match:			name = name.replace('&#8217;','\'').replace('#038;','').replace('\\xc3\\xa9','e').replace('&#8211;','-').replace('&#039;','`')			name = name + " " + " " + " " + season + " " + "x" + " " + episode			addDir(name,url,12,img,fanart)	try:		np=re.compile("<link rel='next' href='(.+?)'", re.DOTALL | re.IGNORECASE).findall(link)[0]		name = '[COLOR dodgerblue]' + 'Next Page >>' + '[/COLOR]'		addDir(name,np,200,next,fanart)	except:pass				xbmc.executebuiltin('Container.SetViewMode(50)')	def GETGENRES(url,name):        link = open_url(url)        match=re.compile('<a href="([^"]+)" title="[^"]+">([^"]+)</a>',re.DOTALL).findall(link)        for url, name, total in match:		if "&" in name:			pass		else:			name = name.replace('&#8217;','\'').replace('#038;','').replace('\\xc3\\xa9','e').replace('&#8211;','-').replace('&#039;','`')			name = name + " " + " " + " " + "|" + " " + " " + " " + "[COLOR dodgerblue]" + total + "[/COLOR]"			addDir(name,url,19, art+'genres.png',fanart='')	xbmc.executebuiltin('Container.SetViewMode(50)')def GETRELEASE(url,name):        link = open_url(url)        match=re.compile('<a href="https://321movies.cc/release/([^"]+)">([^"]+)</a>',re.DOTALL).findall(link)        for url, name, in match:		if "Movies" in name:			pass		else:			url = BASEURL + "/release/" + url			addDir(name,url,19, art+'release.png',fanart='')	xbmc.executebuiltin('Container.SetViewMode(50)')def GETSOURCE(name,url):	link = open_url(url)	url = re.compile('<iframe class="metaframe rptss" src="(.+?)"',re.DOTALL).findall(link)	for url in url:		if 'youtube' in url:			name = "[B]" + "[COLOR dodgerblue]" + "YouTube:" + "[/COLOR]" + "[COLOR red]" + "Full Version" + "[/COLOR]" + "[/B]"			addLink(name,url,201,iconimage,fanart)		elif 'openload' in url:			name = "[B]" + "[COLOR dodgerblue]" + "OpenLoad:" + "[/COLOR]" + "[COLOR red]" + "Full Version" + "[/COLOR]" + "[/B]"			addLink(name,url,201,iconimage,fanart)	xbmc.executebuiltin('Container.SetViewMode(50)')	def SEARCH_MOVIES(url):	search_entered = ''	keyboard = xbmc.Keyboard(search_entered, 'Search 321Movies.co')	keyboard.doModal()	if keyboard.isConfirmed():		search_entered = keyboard.getText().replace(' ','+')	if len(search_entered)>1:		url = url + '?s=' + search_entered		progress = xbmcgui.DialogProgress()		GETSEARCHMOVIES(url)def GETSEARCHMOVIES(url):	link = open_url(url)	match=re.compile('class="image">.*?href="([^"]+)">[^"]+"([^"]+)"[^"]+"([^"]+)"', re.DOTALL | re.IGNORECASE).findall(link)	for url, img, name in match:			try:				if name.startswith('Watch '): 					name = re.compile("Watch (.*?) For Free", re.DOTALL | re.IGNORECASE).findall(name)[0]					name = name.replace('&#8217;','\'').replace('#038;','').replace('\\xc3\\xa9','e').replace('&#8211;','-').replace('&#215;','x')					url = BASEURL + '/film/' + url					addDir(name,url,12,img,fanart)				elif '/anime/' in url:					name = name.replace('&#8217;','\'').replace('#038;','').replace('\\xc3\\xa9','e').replace('&#8211;','-').replace('&#215;','x')					url = BASEURL + '/anime/' + url					addDir(name,url,4,img,fanart)				elif '/seasons/' in url:					name = name.replace('&#8217;','\'').replace('#038;','').replace('\\xc3\\xa9','e').replace('&#8211;','-').replace('&#215;','x')					url = BASEURL + '/seasons/' + url					addDir(name,url,10,img,fanart)				elif '/episodes/' in url:					name = name.replace('&#8217;','\'').replace('#038;','').replace('\\xc3\\xa9','e').replace('&#8211;','-').replace('&#215;','x')					url = BASEURL + '/episodes/' + url					addDir(name,url,12,img,fanart)			except:pass	try:		np=re.compile('<a href="http://321movies.co/page/([^"]+)"', re.DOTALL | re.IGNORECASE).findall(link)[0]		if '2' in np:			np = BASEURL + '/page/' + np			name = '[COLOR dodgerblue]' + 'Next Page >>' + '[/COLOR]'			addDir(name,np,17,next,fanart)		elif '3' in np:			np = BASEURL + '/page/' + np			name = '[COLOR dodgerblue]' + 'Next Page >>' + '[/COLOR]'			addDir(name,np,17,next,fanart)	except:pass	xbmc.executebuiltin('Container.SetViewMode(50)')	def resolve(name,url,iconimage):	progress = xbmcgui.DialogProgress()	progress.create('Stream TVsupertuga', 'Opening Stream:')	progress.update(10, "", name, "" )	try: 		url = urlresolver.resolve(url)		liz=xbmcgui.ListItem(name, iconImage=iconimage,thumbnailImage=iconimage); liz.setInfo( type="Video", infoLabels={ "Title": name } )		ok=xbmcplugin.addDirectoryItem(handle=int(sys.argv[1]),url=url,listitem=liz)		liz.setProperty('IsPlayable','true')		xbmc.Player ().play(url, liz, False)	except:pass	xbmcplugin.endOfDirectory(int(sys.argv[1]))